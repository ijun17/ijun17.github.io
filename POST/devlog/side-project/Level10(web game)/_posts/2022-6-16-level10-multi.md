---
layout: post
title: "[Level10] 자바스크립트 WebRTC로 멀티플레이 구현하기(미구현)"
order: 5
---

멀티 플레이는 두 가지 방법으로 구현할 수 있다.

`client-server`
* 두 클라이언트 사이에 서버를 두고 통신한다.
* 두 클라이언트에 일관성을 유지하는 것이 비교적 쉽다.
* 하지만 서버를 사용하므로 비용이 증가한다.

`p2p` 
* 두 클라이언트가 직접 통신한다.
* 두 클라이언트에 일관성을 유지하는데 처리를 해야한다.
* 서버를 사용하지 않으므로 추가 비용이 들지 않는다.

원래는 client-server로 구현을 하였다. 클라이언트는 서버에 자신의 입력 데이터(키보드)를 서버에 전송하고 게임의 연산은 서버에서 진행된다. 서버는 게임 내에 물체를 렌더링하는데 필요한 데이터를 클라이언트로 전송한다.

이 방법은 두 클라이언트가 완전히 같은 결과를 본다는 장점이 있지만, 느렸고 동시에 하나의 멀티 게임 밖에 할 수 없었다. 서버에서 게임에 관련된 연산을 하면서 1초에 30번씩 렌더링 데이터를 정리해서 클라이언트에 보내줘야했기 때문이다. 라즈베리 파이에 호스팅을 했기 때문에 느렸을 수도 있다.

따라서 p2p 통신으로 입력 데이터만 상대에게 전송하고 게임 연산은 각자 클라이언트에서 진행하도록 방향을 바꾸었다. 여기서 게임의 일관성이 유지되려면 다음에 가정이 필요한다.
* **소수점 연산 결과가 모든 브라우저에서 같다.**
* **무작위 요소가 없다.**
* **사용자 입력의 처리가 동기적이다.**

p2p 통신은 WebRTC API의 datachannel로 하면 된다. 상대에게 보내야할 데이터는 **시간**과 **입력데이터**이다.